POST /api/v2/setup : ì´ APIëŠ” InfluxDBê°€ ì•„ì§ ì´ˆê¸° ì„¤ì •ì´ ì•ˆ ëœ ìƒíƒœì—ì„œë§Œ ì‘ë™
í•œ ë²ˆ setupì´ ì™„ë£Œë˜ë©´, ë‹¤ì‹œ ì´ APIë¡œ ì„¤ì •í•˜ëŠ” ê±´ ë¶ˆê°€ëŠ¥ (409 Conflict ì—ëŸ¬ ë‚¨)
ë‹¤ì‹œ ì´ˆê¸°í™”í•˜ë ¤ë©´ DB ì‚­ì œí•˜ê³  ìƒˆë¡œ ì‹œì‘í•´ì•¼ ë¼ (ì˜ˆ: influxd --force-remove-setup ê°™ì€ ë°©ì‹)



request
Content-Type: application/json
{
  "username": "admin",
  "password": "mySecurePassword",
  "org": "my-org",
  "bucket": "default-bucket",
  "retentionPeriodSeconds": 0
}

response
{
  "auth": {
    "token": "admin-token-xxxxxx"
  },
  "bucket": {
    "id": "...",
    "name": "default-bucket"
  },
  ...
}

////FASTAPI/////
import httpx

async def setup_influxdb():
    url = "http://localhost:8086/api/v2/setup"
    payload = {
        "username": "admin",
        "password": "mySecurePassword",
        "org": "nteksystem",
        "bucket": "device_data",
        "retentionPeriodSeconds": 0
    }

    async with httpx.AsyncClient() as client:
        try:
            response = await client.post(url, json=payload)
            if response.status_code == 201:
                token = response.json()['auth']['token']
                print("InfluxDB setup ì™„ë£Œ, í† í°:", token)
                # ğŸ‘‰ ì—¬ê¸°ì„œ token íŒŒì¼ ì €ì¥ ë˜ëŠ” DB ì €ì¥
                with open("/etc/influxdb_token.txt", "w") as f:
                    f.write(token)
            elif response.status_code == 409:
                print("ì´ë¯¸ setup ë¨")
            else:
                print("InfluxDB setup ì‹¤íŒ¨:", response.text)
        except Exception as e:
            print("InfluxDB ì—°ê²° ì‹¤íŒ¨:", str(e))

[ì¬ë¶€íŒ… ì‹œ setup ì¤‘ë³µ ë§‰ê¸°]
from pathlib import Path

if not Path("/etc/setup_done").exists():
    await setup_influxdb()
    Path("/etc/setup_done").touch()